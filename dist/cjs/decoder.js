Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./error.js");function r({complete:r},o){if(o instanceof Buffer)o=o.toString("utf-8");else if("string"!=typeof o)throw new e.TokenError(e.TokenError.codes.invalidType,"The token must be a string or a buffer.");const t=o.indexOf("."),n=o.lastIndexOf(".");if(-1===t||t>=n)throw new e.TokenError(e.TokenError.codes.malformed,"The token is malformed.");let a=!1;try{const i=JSON.parse(Buffer.from(o.slice(0,t),"base64").toString("utf-8"));if("JWT"!==i.typ)throw new e.TokenError(e.TokenError.codes.invalidType,"The type must be JWT.",{header:i});a=!0;let s=Buffer.from(o.slice(t+1,n),"base64").toString("utf-8");if(s=JSON.parse(s),!s||"object"!=typeof s)throw new e.TokenError(e.TokenError.codes.invalidPayload,"The payload must be an object",{payload:s});return r?{header:i,payload:s,signature:o.slice(n+1),input:o.slice(0,n)}:s}catch(r){throw e.TokenError.wrap(r,e.TokenError.codes.malformed,`The token ${a?"payload":"header"} is not a valid base64url serialized JSON.`)}}exports.createDecoder=function(e={}){const o=e.complete||!1;return r.bind(null,{complete:o})};
